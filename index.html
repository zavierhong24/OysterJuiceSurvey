<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>èšæ±æ¶ˆè´¹åå¥½è°ƒç ”</title>
    <!-- Bmob SDK -->
    <script src="https://unpkg.com/bmob-js-sdk-v4/dist/Bmob-4.0.0.min.js"></script>
    <!-- æ‹–æ‹½æ’åºåº“ SortableJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <style>
        :root {
            --primary: #D94436; /* èšæ²¹çº¢ */
            --primary-light: #FFECEB;
            --bg: #F5F6FA;
            --card: #FFFFFF;
            --text: #2D3436;
            --gray: #636E72;
            --radius: 12px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg);
            margin: 0; padding: 0;
            color: var(--text);
            padding-bottom: 80px;
            user-select: none; /* é˜²æ­¢é•¿æŒ‰å¤åˆ¶æ–‡æœ¬å½±å“ä½“éªŒ */
        }

        /* é¡¶éƒ¨å¯¼èˆª */
        .header {
            background: linear-gradient(135deg, #D94436 0%, #FF6B6B 100%);
            padding: 30px 20px 40px;
            color: white;
            border-bottom-left-radius: 24px;
            border-bottom-right-radius: 24px;
            box-shadow: 0 4px 15px rgba(217, 68, 54, 0.3);
        }
        .header h1 { margin: 0; font-size: 22px; font-weight: 800; }
        .header p { margin: 8px 0 0; font-size: 13px; opacity: 0.9; }

        .container { max-width: 600px; margin: -30px auto 0; padding: 0 16px; position: relative; z-index: 10; }

        /* å¡ç‰‡é€šç”¨æ ·å¼ */
        .card {
            background: var(--card);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.04);
            transition: transform 0.2s;
        }
        .q-title {
            font-weight: 700; font-size: 16px; margin-bottom: 16px;
            line-height: 1.5; color: #000;
        }
        .q-tag {
            background: var(--primary-light); color: var(--primary);
            font-size: 11px; padding: 2px 6px; border-radius: 4px;
            vertical-align: middle; margin-right: 5px;
        }

        /* é€‰é¡¹æŒ‰é’® */
        .btn-group { display: flex; flex-direction: column; gap: 10px; }
        .btn-option {
            padding: 14px;
            background: #F8F9FA;
            border: 1px solid #EEE;
            border-radius: 10px;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            font-size: 14px;
        }
        .btn-option:active { transform: scale(0.98); }
        .btn-option.selected {
            background: var(--primary-light);
            border-color: var(--primary);
            color: var(--primary);
            font-weight: bold;
        }
        .btn-option.selected::after {
            content: 'âœ”'; position: absolute; right: 15px;
        }

        /* å“ç‰Œé€‰æ‹©æ¸¸æˆåŒº (Q5) */
        .brand-slots {
            display: flex; gap: 10px; margin-bottom: 15px;
        }
        .brand-slot {
            flex: 1; height: 40px; border: 2px dashed #DDD;
            border-radius: 8px; display: flex; align-items: center; justify-content: center;
            font-size: 12px; color: #AAA; background: #FAFAFA;
            position: relative;
        }
        .brand-slot.filled {
            background: var(--primary-light); border-color: var(--primary);
            color: var(--primary); border-style: solid; font-weight: bold;
        }
        .brand-slot .close-btn {
            position: absolute; top: -5px; right: -5px;
            background: #999; color: white; border-radius: 50%;
            width: 14px; height: 14px; font-size: 10px; line-height: 14px;
            text-align: center; cursor: pointer;
        }
        .brand-pool {
            display: flex; flex-wrap: wrap; gap: 8px;
        }
        .brand-chip {
            padding: 6px 12px; background: white; border: 1px solid #DDD;
            border-radius: 20px; font-size: 13px; cursor: pointer;
        }
        .brand-chip.disabled {
            opacity: 0.3; pointer-events: none; background: #EEE;
        }

        /* æ‹–æ‹½æ’åºåŒº (Q8) */
        .sort-list { list-style: none; padding: 0; margin: 0; }
        .sort-item {
            background: white; border: 1px solid #EEE;
            padding: 12px 15px; margin-bottom: 8px;
            border-radius: 8px; display: flex; align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
            touch-action: none; /* å…³é”®ï¼šé˜²æ­¢æ‹–æ‹½æ—¶è§¦å‘æ»šåŠ¨ */
        }
        .sort-item .sort-handle {
            color: #BBB; font-size: 20px; cursor: grab; padding-left: 10px;
        }
        .sort-rank-num {
            background: #EEE; width: 20px; height: 20px; 
            border-radius: 50%; font-size: 12px; 
            display: flex; align-items: center; justify-content: center;
            margin-right: 10px; color: #666; font-weight: bold;
        }
        .sort-ghost { opacity: 0.4; background: var(--primary-light); }

        /* è¾“å…¥æ¡† */
        .input-text {
            width: 100%; padding: 12px; border: 1px solid #DDD;
            border-radius: 8px; box-sizing: border-box; margin-top: 5px;
        }

        /* æäº¤æŒ‰é’® */
        .submit-btn {
            background: var(--primary); color: white;
            width: 100%; padding: 16px; border: none;
            border-radius: 30px; font-size: 18px; font-weight: bold;
            box-shadow: 0 6px 20px rgba(217, 68, 54, 0.4);
            margin-top: 10px; cursor: pointer;
        }
        .submit-btn:disabled { background: #CCC; box-shadow: none; }

        .hidden { display: none; }
        .section-title {
            margin: 25px 0 15px; font-size: 14px; color: #888;
            font-weight: bold; letter-spacing: 1px; text-align: center;
        }
        .section-title::before, .section-title::after {
            content: "â€”â€”"; margin: 0 10px; opacity: 0.3;
        }
    </style>
</head>
<body>

<div class="header">
    <h1>ğŸ¥˜ èšæ±/èšæ²¹æ¶ˆè´¹ä¹ æƒ¯è°ƒç ”</h1>
    <p>ç‚¹ä¸€ç‚¹ã€æ‹–ä¸€æ‹–ï¼Œ2åˆ†é’Ÿå®Œæˆ</p>
</div>

<div class="container">
    <form id="surveyForm">

        <!-- ç¬¬ä¸€éƒ¨åˆ† -->
        <div class="section-title">01 / åŸºç¡€ç”»åƒ</div>

        <!-- Q1 å¹´é¾„ -->
        <div class="card">
            <div class="q-title"><span class="q-tag">Q1</span>æ‚¨çš„å¹´é¾„æ®µï¼Ÿ</div>
            <div class="btn-group">
                <div class="btn-option" onclick="singleSelect('q1', this, '18-25å²')">ğŸŒ± 18-25å²</div>
                <div class="btn-option" onclick="singleSelect('q1', this, '26-35å²')">ğŸ’¼ 26-35å²</div>
                <div class="btn-option" onclick="singleSelect('q1', this, '36-45å²')">ğŸ  36-45å²</div>
                <div class="btn-option" onclick="singleSelect('q1', this, '46-55å²')">â˜• 46-55å²</div>
                <div class="btn-option" onclick="singleSelect('q1', this, '56å²åŠä»¥ä¸Š')">ğŸ‘´ 56å²åŠä»¥ä¸Š</div>
            </div>
            <input type="hidden" id="q1">
        </div>

        <!-- Q2 è´­ä¹°è€… -->
        <div class="card">
            <div class="q-title"><span class="q-tag">Q2</span>å®¶ä¸­è°ä¹°è°ƒå‘³å“ï¼Ÿ</div>
            <div class="btn-group">
                <div class="btn-option" onclick="singleSelect('q2', this, 'è‡ªå·±')">ğŸ™‹ è‡ªå·±</div>
                <div class="btn-option" onclick="singleSelect('q2', this, 'é…å¶/ä¼´ä¾£')">ğŸ’‘ é…å¶/ä¼´ä¾£</div>
                <div class="btn-option" onclick="singleSelect('q2', this, 'çˆ¶æ¯')">ğŸ‘ª çˆ¶æ¯</div>
                <div class="btn-option" onclick="singleSelect('q2', this, 'å…¶ä»–')">ğŸ”˜ å…¶ä»–</div>
            </div>
            <input type="hidden" id="q2">
        </div>

        <!-- Q3 æ²¿æµ· (é€»è¾‘ç‰¹æ®Šï¼šè‡³å¤šé€‰2ï¼Œ"éƒ½ä¸æ˜¯"äº’æ–¥) -->
        <div class="card">
            <div class="q-title"><span class="q-tag">Q3</span>æ‚¨æ˜¯æ²¿æµ·åœ°åŒºçš„å—ï¼Ÿ<span style="font-weight:normal;font-size:12px;color:#888">ï¼ˆå¤šé€‰ï¼‰</span></div>
            <div class="btn-group">
                <div class="btn-option" onclick="handleCoastal(this, 'å¸¸ä½åœ°æ˜¯')">ğŸŒŠ å¸¸ä½åœ°æ˜¯æ²¿æµ·åœ°åŒº</div>
                <div class="btn-option" onclick="handleCoastal(this, 'ç¥–ç±æ˜¯')">ğŸ® ç¥–ç±æ˜¯æ²¿æµ·åœ°åŒº</div>
                <div class="btn-option" onclick="handleCoastal(this, 'éƒ½ä¸æ˜¯')">ğŸ”ï¸ éƒ½ä¸æ˜¯</div>
            </div>
        </div>

        <!-- Q4 é¢‘ç‡ -->
        <div class="card">
            <div class="q-title"><span class="q-tag">Q4</span>èšæ²¹ä½¿ç”¨é¢‘ç‡ï¼Ÿ</div>
            <div class="btn-group">
                <div class="btn-option" onclick="handleFreq(this, 'å‡ ä¹æ¯å¤©')">ğŸ”¥ å‡ ä¹æ¯å¤©ä½¿ç”¨</div>
                <div class="btn-option" onclick="handleFreq(this, 'æ¯å‘¨å‡ æ¬¡')">ğŸ—“ï¸ æ¯å‘¨å‡ æ¬¡</div>
                <div class="btn-option" onclick="handleFreq(this, 'æ¯æœˆå‡ æ¬¡')">ğŸŒ™ æ¯æœˆå‡ æ¬¡</div>
                <div class="btn-option" onclick="handleFreq(this, 'å¾ˆå°‘ä½¿ç”¨')">â„ï¸ å¾ˆå°‘ä½¿ç”¨</div>
                <div class="btn-option" onclick="handleFreq(this, 'ä»ä¸ä½¿ç”¨')">âŒ ä»ä¸ä½¿ç”¨</div>
            </div>
            <input type="hidden" id="q4">
        </div>

        <!-- Q4.2 ä¸ä½¿ç”¨åŸå›  (é€»è¾‘æ˜¾ç¤º) -->
        <div class="card hidden" id="card_q4_2">
            <div class="q-title"><span class="q-tag">Q4.2</span>ä¸çˆ±ç”¨çš„åŸå› æ˜¯ï¼Ÿ<span style="font-weight:normal;font-size:12px;color:#888">ï¼ˆå¤šé€‰ï¼‰</span></div>
            <div class="btn-group">
                <div class="btn-option" onclick="toggleMulti(this)">ğŸ§‚ éœ€è¦æ§é’ /ä½ç›é¥®é£Ÿ</div>
                <div class="btn-option" onclick="toggleMulti(this)">ğŸŸ å¿Œå£/ä¸å–œæ¬¢æµ·è…¥å‘³</div>
                <div class="btn-option" onclick="toggleMulti(this)">ğŸš‘ æµ·é²œè¿‡æ•</div>
                <div class="btn-option" onclick="toggleMulti(this)">ğŸ§ª ä¸å–œæ¬¢æ·»åŠ å‰‚</div>
                <div class="btn-option" onclick="toggleMulti(this)">ğŸ¬ æ§ç³–/ä½ç¢³æ°´</div>
                <div class="btn-option" onclick="toggleMulti(this)">ğŸ¤· ä¸çŸ¥é“æ€ä¹ˆç”¨/æ²¡å¿…è¦</div>
                <div class="btn-option" onclick="toggleMulti(this)">ğŸ¨ è‰²æ³½å¤ªæ·±</div>
                <div class="btn-option" onclick="toggleMulti(this)">ğŸ² æœ‰å…¶ä»–æ›¿ä»£å“</div>
                <div class="btn-option" onclick="toggleMulti(this)">âšª å…¶ä»– <input type="text" class="input-text" onclick="event.stopPropagation()" style="width:100px; padding:4px; display:inline-block; margin:0"></div>
            </div>
        </div>

        <!-- ç¬¬äºŒéƒ¨åˆ† -->
        <div class="section-title">02 / å“ç‰Œä¸åå¥½</div>

        <!-- Q5 å“ç‰Œå°è±¡ (äº’åŠ¨æ¸¸æˆ) -->
        <div class="card">
            <div class="q-title"><span class="q-tag">Q5</span>æåˆ°èšæ²¹ï¼Œæ‚¨è„‘æµ·é‡Œå‰ä¸‰ä¸ªå“ç‰Œï¼Ÿ</div>
            <p style="font-size:12px; color:#666; margin-bottom:10px;">ğŸ‘‡ ç‚¹å‡»ä¸‹æ–¹æ ‡ç­¾ï¼Œå¡«å…¥ä¸Šæ–¹æ ¼å­</p>
            
            <!-- ç»“æœå±•ç¤ºæ§½ -->
            <div class="brand-slots">
                <div class="brand-slot" id="slot_1" onclick="clearSlot(0)">1st</div>
                <div class="brand-slot" id="slot_2" onclick="clearSlot(1)">2nd</div>
                <div class="brand-slot" id="slot_3" onclick="clearSlot(2)">3rd</div>
            </div>

            <!-- å“ç‰Œæ±  -->
            <div class="brand-pool">
                <div class="brand-chip" onclick="pickBrand(this, 'æµ·å¤©')">æµ·å¤©</div>
                <div class="brand-chip" onclick="pickBrand(this, 'æé”¦è®°')">æé”¦è®°</div>
                <div class="brand-chip" onclick="pickBrand(this, 'å¨é‚¦')">å¨é‚¦</div>
                <div class="brand-chip" onclick="pickBrand(this, 'åƒç¦¾')">åƒç¦¾</div>
                <div class="brand-chip" onclick="pickBrand(this, 'æ—å°ç”Ÿ')">æ—å°ç”Ÿ</div>
                <div class="brand-chip" onclick="pickBrand(this, 'é²èŠ±')">é²èŠ±</div>
                <div class="brand-chip" onclick="pickBrand(this, 'æ¬£å’Œ')">æ¬£å’Œ</div>
                <div class="brand-chip" onclick="pickBrand(this, 'è‡´ç¾æ–‹')">è‡´ç¾æ–‹</div>
                <div class="brand-chip" onclick="pickBrand(this, 'æ²™äº•')">æ²™äº•</div>
                <div class="brand-chip" onclick="pickBrand(this, 'å…¶ä»–')">å…¶ä»–</div>
            </div>
            <!-- æ‰‹åŠ¨è¡¥å…… -->
            <input type="text" id="q5_manual" class="input-text hidden" placeholder="è¯·è¾“å…¥å…¶ä»–å“ç‰Œåç§°">
        </div>

        <!-- Q6 æœ€è¿‘è´­ä¹° -->
        <div class="card">
            <div class="q-title"><span class="q-tag">Q6</span>æœ€è¿‘ä¸€æ¬¡ä¹°çš„æ˜¯ï¼Ÿ</div>
            <div class="btn-group">
                <div class="btn-option" onclick="singleSelect('q6', this, 'æµ·å¤©')">æµ·å¤©</div>
                <div class="btn-option" onclick="singleSelect('q6', this, 'æé”¦è®°')">æé”¦è®°</div>
                <div class="btn-option" onclick="singleSelect('q6', this, 'å¨é‚¦')">å¨é‚¦</div>
                <div class="btn-option" onclick="singleSelect('q6', this, 'åƒç¦¾')">åƒç¦¾</div>
                <div class="btn-option" onclick="singleSelect('q6', this, 'æ—å°ç”Ÿ')">æ—å°ç”Ÿ</div>
                <div class="btn-option" onclick="singleSelect('q6', this, 'æ²™äº•ä¹¡')">æ²™äº•ä¹¡</div>
                <div class="btn-option" onclick="singleSelect('q6', this, 'é˜³æ±Ÿ')">é˜³æ±Ÿ</div>
                <div class="btn-option" onclick="singleSelect('q6', this, 'è¿›å£å“ç‰Œ')">ğŸŒ è¿›å£(æ³°å›½ä¸»å¨/éŸ©å›½æ¸…å‡€å›­ç­‰)</div>
                <div class="btn-option" onclick="singleSelect('q6', this, 'å…¶ä»–')">âšª å…¶ä»– <input type="text" id="q6_other" onclick="event.stopPropagation()" style="border:none; background:transparent; border-bottom:1px solid #999;"></div>
            </div>
            <input type="hidden" id="q6">
        </div>

        <!-- Q7 è´­ä¹°åŸå›  -->
        <div class="card">
            <div class="q-title"><span class="q-tag">Q7</span>ä¹°å®ƒçš„åŸå› æ˜¯ï¼Ÿ<span style="font-weight:normal;font-size:12px;color:#888">ï¼ˆæœ€å¤šé€‰3é¡¹ï¼‰</span></div>
            <div class="btn-group" id="q7_group">
                <div class="btn-option" onclick="toggleMultiLimit(this, 3)">ğŸ† å“ç‰Œä¿¡èª‰å¥½</div>
                <div class="btn-option" onclick="toggleMultiLimit(this, 3)">ğŸ˜‹ å£å‘³/é²œå‘³å¥½</div>
                <div class="btn-option" onclick="toggleMultiLimit(this, 3)">ğŸƒ é…æ–¹çº¯å‡€/é›¶æ·»åŠ </div>
                <div class="btn-option" onclick="toggleMultiLimit(this, 3)">ğŸ’° ä»·æ ¼å®æƒ </div>
                <div class="btn-option" onclick="toggleMultiLimit(this, 3)">ğŸ—£ï¸ äº²å‹æ¨è</div>
                <div class="btn-option" onclick="toggleMultiLimit(this, 3)">ğŸ ä¿ƒé”€æ´»åŠ¨</div>
                <div class="btn-option" onclick="toggleMultiLimit(this, 3)">ğŸ“¦ åŒ…è£…è®¾è®¡å¥½</div>
                <div class="btn-option" onclick="toggleMultiLimit(this, 3)">ğŸº ä¼ ç»Ÿå·¥è‰º(éé—/å¤æ³•)</div>
                <div class="btn-option" onclick="toggleMultiLimit(this, 3)">ğŸ¥¬ æœ‰æœº</div>
                <div class="btn-option" onclick="toggleMultiLimit(this, 3)">âšª å…¶ä»–</div>
            </div>
        </div>

        <!-- Q8 æ’åºé¢˜ (æ‹–æ‹½) -->
        <div class="card">
            <div class="q-title"><span class="q-tag">Q8</span>æœ€å…³æ³¨å› ç´ æ’åº <span style="font-weight:normal;font-size:12px;color:#D94436">ï¼ˆé•¿æŒ‰æ‹–æ‹½æ’åº â†•ï¸ï¼‰</span></div>
            <p style="font-size:12px; color:#666; margin-bottom:10px;">è¯·å°†æœ€é‡è¦çš„å› ç´ æ‹–åˆ°æœ€ä¸Šé¢ï¼š</p>
            
            <ul class="sort-list" id="sortList">
                <li class="sort-item" data-id="å£å‘³"><div style="display:flex;align-items:center"><span class="sort-rank-num">1</span>å£å‘³ä¸é²œåº¦</div><span class="sort-handle">â˜°</span></li>
                <li class="sort-item" data-id="èšæ±å«é‡"><div style="display:flex;align-items:center"><span class="sort-rank-num">2</span>èšæ±å«é‡é«˜ä½</div><span class="sort-handle">â˜°</span></li>
                <li class="sort-item" data-id="é…æ–™è¡¨"><div style="display:flex;align-items:center"><span class="sort-rank-num">3</span>é…æ–™è¡¨æ¸…æ´(é›¶æ·»åŠ )</div><span class="sort-handle">â˜°</span></li>
                <li class="sort-item" data-id="ä»·æ ¼"><div style="display:flex;align-items:center"><span class="sort-rank-num">4</span>ä»·æ ¼</div><span class="sort-handle">â˜°</span></li>
                <li class="sort-item" data-id="å“ç‰Œ"><div style="display:flex;align-items:center"><span class="sort-rank-num">5</span>å“ç‰Œ</div><span class="sort-handle">â˜°</span></li>
                <li class="sort-item" data-id="åŒ…è£…"><div style="display:flex;align-items:center"><span class="sort-rank-num">6</span>åŒ…è£…ä¾¿åˆ©æ€§</div><span class="sort-handle">â˜°</span></li>
                <li class="sort-item" data-id="ä¿ƒé”€"><div style="display:flex;align-items:center"><span class="sort-rank-num">7</span>ä¿ƒé”€åŠ›åº¦</div><span class="sort-handle">â˜°</span></li>
                <li class="sort-item" data-id="é™„åŠ å€¼"><div style="display:flex;align-items:center"><span class="sort-rank-num">8</span>å…¶ä»–é™„åŠ å€¼(éé—/æœ‰æœº)</div><span class="sort-handle">â˜°</span></li>
            </ul>
        </div>

        <!-- ç¬¬ä¸‰éƒ¨åˆ† -->
        <div class="section-title">03 / åå¥½ä¸è¶‹åŠ¿</div>

        <!-- Q9 æ–°å‹èšæ²¹ -->
        <div class="card">
            <div class="q-title"><span class="q-tag">Q9</span>æ‚¨æœ€èƒ½æ¥å—å“ªç§æ–°å‹èšæ²¹ï¼Ÿ</div>
            <div class="btn-group">
                <div class="btn-option" onclick="singleSelect('q9', this, '100%èšæ±')">ğŸ’§ ç¨€ä½†å¾ˆé²œç¾çš„100%èšæ±</div>
                <div class="btn-option" onclick="singleSelect('q9', this, 'ä¼´é¦…èšæ²¹')">ğŸ¯ ç¨ ä½†é†‡åšçš„ä¼´é¦…ç”¨èšæ²¹</div>
                <div class="btn-option" onclick="singleSelect('q9', this, 'ç´ èšæ²¹')">ğŸ„ æ¾èŒ¸ç­‰ä¸ºåŸæ–™çš„ç´ èšæ²¹</div>
                <div class="btn-option" onclick="singleSelect('q9', this, 'èšæ²¹é²œéœ²')">ğŸ¥£ å¤šé‡æ»‹å‘³çš„èšæ²¹é²œéœ²</div>
                <div class="btn-option" onclick="singleSelect('q9', this, 'éƒ½ä¸å–œæ¬¢')">ğŸ™… éƒ½ä¸å–œæ¬¢</div>
            </div>
            <input type="hidden" id="q9">
        </div>

        <!-- Q10 å¬è¯´è¿‡æ—å°ç”Ÿç­‰ -->
        <div class="card">
            <div class="q-title"><span class="q-tag">Q10</span>æ˜¯å¦å¬è¯´â€œé«˜èšæ±/æ´å‡€é…æ–¹â€å“ç‰Œï¼Ÿ</div>
            <div class="btn-group">
                <div class="btn-option" onclick="handleQ10(this, 'æ˜¯ï¼Œè´­ä¹°è¿‡')">ğŸ›’ æ˜¯ï¼Œè´­ä¹°è¿‡</div>
                <div class="btn-option" onclick="handleQ10(this, 'æ˜¯ï¼Œå¬è¯´è¿‡')">ğŸ‘‚ æ˜¯ï¼Œå¬è¯´è¿‡ä½†æœªè´­ä¹°</div>
                <div class="btn-option" onclick="handleQ10(this, 'æ²¡å¬è¯´è¿‡')">âŒ æ²¡å¬è¯´è¿‡</div>
            </div>
            <input type="hidden" id="q10">
        </div>

        <!-- Q11 çœ‹æ³• (é€»è¾‘æ˜¾ç¤º) -->
        <div class="card hidden" id="card_q11">
            <div class="q-title"><span class="q-tag">Q11</span>æ‚¨å¯¹è¿™ç±»äº§å“çš„çœ‹æ³•ï¼Ÿ<span style="font-weight:normal;font-size:12px;color:#888">ï¼ˆå¤šé€‰ï¼‰</span></div>
            <div class="btn-group">
                <div class="btn-option" onclick="toggleMulti(this)">ğŸ’ æ„¿æ„ä¸ºå“è´¨/å¥åº·ä»˜è´¹</div>
                <div class="btn-option" onclick="toggleMulti(this)">ğŸ’¸ æ„Ÿå…´è¶£ï¼Œä½†è§‰å¾—å¤ªè´µ</div>
                <div class="btn-option" onclick="toggleMulti(this)">ğŸ˜‘ è®¤ä¸ºå·®åˆ«ä¸å¤§</div>
                <div class="btn-option" onclick="toggleMulti(this)">ğŸ§  ä¸ä¿¡ä»»å®£ä¼ æ¦‚å¿µ</div>
                <div class="btn-option" onclick="toggleMulti(this)">âšª å…¶ä»–</div>
            </div>
        </div>

        <!-- Q12 ä»·æ ¼ -->
        <div class="card">
            <div class="q-title"><span class="q-tag">Q12</span>500gèšæ²¹ï¼Œèƒ½æ¥å—çš„ä»·æ ¼ï¼Ÿ</div>
            <div class="btn-group">
                <div class="btn-option" onclick="singleSelect('q12', this, '15å…ƒä»¥ä¸‹')">ğŸ“‰ 15å…ƒä»¥ä¸‹</div>
                <div class="btn-option" onclick="singleSelect('q12', this, '16-25å…ƒ')">âš–ï¸ 16-25å…ƒ</div>
                <div class="btn-option" onclick="singleSelect('q12', this, '26-35å…ƒ')">ğŸ“ˆ 26-35å…ƒ</div>
                <div class="btn-option" onclick="singleSelect('q12', this, '36å…ƒä»¥ä¸Š')">ğŸ‘‘ 36å…ƒä»¥ä¸Š</div>
            </div>
            <input type="hidden" id="q12">
        </div>

        <!-- Q13 æœªæ¥è¶‹åŠ¿ -->
        <div class="card">
            <div class="q-title"><span class="q-tag">Q13</span>æœªæ¥é€‰æ‹©èšæ²¹æ›´å…³æ³¨ä»€ä¹ˆï¼Ÿ<span style="font-weight:normal;font-size:12px;color:#888">ï¼ˆæœ€å¤š3é¡¹ï¼‰</span></div>
            <div class="btn-group" id="q13_group">
                <div class="btn-option" onclick="toggleMultiLimit(this, 3)">ğŸ¥— åŠŸèƒ½æ€§(å‡ç›/é›¶æ·»åŠ )</div>
                <div class="btn-option" onclick="toggleMultiLimit(this, 3)">ğŸ¦ª é«˜ç«¯åŒ–(é«˜èšæ±/åŸäº§åœ°)</div>
                <div class="btn-option" onclick="toggleMultiLimit(this, 3)">ğŸ–ï¸ ä¾¿æ·æ€§(æŒ¤æŒ¤åŒ…/å°åŒ…è£…)</div>
                <div class="btn-option" onclick="toggleMultiLimit(this, 3)">â™»ï¸ å¯æŒç»­(ç¯ä¿åŒ…è£…)</div>
                <div class="btn-option" onclick="toggleMultiLimit(this, 3)">ğŸŒ¶ï¸ å£å‘³åˆ›æ–°(è¾£å‘³/è’œé¦™)</div>
            </div>
        </div>

        <!-- Q14 æ¸ é“ -->
        <div class="card">
            <div class="q-title"><span class="q-tag">Q14</span>å“ªå„¿äº†è§£æ–°è°ƒå‘³å“ï¼Ÿ<span style="font-weight:normal;font-size:12px;color:#888">ï¼ˆå¤šé€‰ï¼‰</span></div>
            <div class="btn-group" id="q14_group">
                <div class="btn-option" onclick="toggleMulti(this)">ğŸ“± ç”µå•†å¹³å°(äº¬ä¸œ/å¤©çŒ«)</div>
                <div class="btn-option" onclick="toggleMulti(this)">ğŸ¬ çŸ­è§†é¢‘/ç›´æ’­(æŠ–éŸ³/å¿«æ‰‹)</div>
                <div class="btn-option" onclick="toggleMulti(this)">ğŸ—£ï¸ äº²å‹å£ç¢‘æ¨è</div>
                <div class="btn-option" onclick="toggleMulti(this)">ğŸª çº¿ä¸‹å•†è¶…é™ˆåˆ—</div>
                <div class="btn-option" onclick="toggleMulti(this)">ğŸ¥¬ å†œè´¸å¸‚åœºæ‘Šä½</div>
                <div class="btn-option" onclick="toggleMulti(this)">ğŸ‘©â€ğŸ³ ç¾é£Ÿåšä¸»/è¯„æµ‹</div>
                <div class="btn-option" onclick="toggleMulti(this)">âšª å…¶ä»– <input type="text" class="input-text" onclick="event.stopPropagation()" style="width:100px; padding:4px; display:inline-block; margin:0"></div>
            </div>
        </div>

        <button type="button" class="submit-btn" id="submitBtn" onclick="submitSurvey()">æäº¤é—®å· ğŸ‰</button>
        <p style="text-align: center; color: #999; font-size: 12px; margin-top: 15px;">æ„Ÿè°¢æ‚¨çš„æ”¯æŒ</p>

    </form>
</div>

<script>
    // ===============================================
    // ğŸ”´ å¯†é’¥é…ç½®
    // ===============================================
    Bmob.initialize("70f9577e95b2858b", "1234567890123456"); 
    // ===============================================

    // --- é€»è¾‘å¤„ç†å‡½æ•° ---

    // é€šç”¨å•é€‰
    function singleSelect(id, btn, value) {
        const container = btn.parentNode;
        container.querySelectorAll('.btn-option').forEach(el => el.classList.remove('selected'));
        btn.classList.add('selected');
        document.getElementById(id).value = value;
    }

    // é€šç”¨å¤šé€‰ (æ— é™åˆ¶)
    function toggleMulti(btn) {
        btn.classList.toggle('selected');
    }

    // é™åˆ¶æ•°é‡çš„å¤šé€‰
    function toggleMultiLimit(btn, limit) {
        const container = btn.parentNode;
        const selected = container.querySelectorAll('.selected').length;
        
        if (btn.classList.contains('selected')) {
            btn.classList.remove('selected');
        } else {
            if (selected >= limit) { alert('æœ¬é¢˜æœ€å¤šé€‰æ‹© ' + limit + ' é¡¹å“¦~'); return; }
            btn.classList.add('selected');
        }
    }

    // Q3 æ²¿æµ·äº’æ–¥é€»è¾‘
    function handleCoastal(btn, type) {
        const parent = btn.parentNode;
        const btns = parent.querySelectorAll('.btn-option');
        
        if (type === 'éƒ½ä¸æ˜¯') {
            // å¦‚æœé€‰äº†éƒ½ä¸æ˜¯ï¼Œå–æ¶ˆå…¶ä»–
            btns.forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
        } else {
            // å¦‚æœé€‰äº†å…·ä½“çš„ï¼Œå–æ¶ˆâ€œéƒ½ä¸æ˜¯â€
            btns[2].classList.remove('selected'); // ç¬¬3ä¸ªæ˜¯â€œéƒ½ä¸æ˜¯â€
            
            // è‡ªèº«åé€‰
            if (btn.classList.contains('selected')) {
                btn.classList.remove('selected');
            } else {
                // é™åˆ¶æœ€å¤šé€‰2ä¸ª
                const count = parent.querySelectorAll('.selected').length;
                if (count >= 2) { alert('æœ€å¤šé€‰2é¡¹'); return; }
                btn.classList.add('selected');
            }
        }
    }

    // Q4 é¢‘ç‡é€»è¾‘ (æ§åˆ¶ Q4.2 æ˜¾ç¤º)
    function handleFreq(btn, value) {
        singleSelect('q4', btn, value);
        const card = document.getElementById('card_q4_2');
        if (value === 'å¾ˆå°‘ä½¿ç”¨' || value === 'ä»ä¸ä½¿ç”¨') {
            card.classList.remove('hidden');
        } else {
            card.classList.add('hidden');
            // æ¸…ç©ºé€‰æ‹©
            card.querySelectorAll('.selected').forEach(el => el.classList.remove('selected'));
        }
    }

    // Q10 é€»è¾‘ (æ§åˆ¶ Q11 æ˜¾ç¤º)
    function handleQ10(btn, value) {
        singleSelect('q10', btn, value);
        const card = document.getElementById('card_q11');
        if (value === 'æ˜¯ï¼Œè´­ä¹°è¿‡') {
            card.classList.remove('hidden');
        } else {
            card.classList.add('hidden');
            card.querySelectorAll('.selected').forEach(el => el.classList.remove('selected'));
        }
    }

    // --- Q5 å“ç‰Œé€‰æ‹©æ¸¸æˆé€»è¾‘ ---
    let selectedBrands = [null, null, null]; // å­˜å‚¨ 1st, 2nd, 3rd

    function pickBrand(chip, brand) {
        if (chip.classList.contains('disabled')) return;
        
        // æ‰¾åˆ°ç¬¬ä¸€ä¸ªç©ºæ§½ä½
        const emptyIndex = selectedBrands.indexOf(null);
        if (emptyIndex === -1) {
            alert("åªèƒ½é€‰æ‹©å‰ä¸‰åå“¦ï¼Œç‚¹å‡»ä¸Šæ–¹æ ¼å­å¯åˆ é™¤é‡é€‰");
            return;
        }

        // å¡«å…¥
        selectedBrands[emptyIndex] = brand;
        
        // UI æ›´æ–°
        renderSlots();
        
        // å¦‚æœæ˜¯â€œå…¶ä»–â€ï¼Œæ˜¾ç¤ºè¾“å…¥æ¡†
        if (brand === 'å…¶ä»–') {
            document.getElementById('q5_manual').classList.remove('hidden');
        }
    }

    function clearSlot(index) {
        const brand = selectedBrands[index];
        if (!brand) return;

        selectedBrands[index] = null;
        
        // å¦‚æœåˆ é™¤äº†â€œå…¶ä»–â€ï¼Œéšè—è¾“å…¥æ¡†
        if (brand === 'å…¶ä»–') {
            document.getElementById('q5_manual').classList.add('hidden');
            document.getElementById('q5_manual').value = "";
        }
        
        // æ•´ç†æ•°ç»„ï¼Œè®©ç©ºä½å¾€åæ’ (å¯é€‰ï¼Œè¿™é‡Œç®€åŒ–ä¸åšï¼Œä¿æŒç©ºä½)
        // å®é™…ä¸Šä¸ºäº†ä½“éªŒï¼Œæˆ‘ä»¬åº”è¯¥æŠŠåé¢çš„ç§»ä¸Šæ¥? ç®—äº†ï¼Œä¿æŒåŸä½æ›´æ¸…æ™°
        
        renderSlots();
    }

    function renderSlots() {
        // æ›´æ–° Slot UI
        selectedBrands.forEach((brand, idx) => {
            const slot = document.getElementById('slot_' + (idx + 1));
            if (brand) {
                slot.innerText = brand;
                slot.classList.add('filled');
                slot.innerHTML = brand + '<div class="close-btn">Ã—</div>';
            } else {
                slot.innerText = (idx === 0 ? "1st" : (idx === 1 ? "2nd" : "3rd"));
                slot.classList.remove('filled');
            }
        });

        // æ›´æ–° Chips çŠ¶æ€ (å·²é€‰çš„å˜ç°)
        const chips = document.querySelectorAll('.brand-chip');
        chips.forEach(chip => {
            if (selectedBrands.includes(chip.innerText)) {
                chip.classList.add('disabled');
            } else {
                chip.classList.remove('disabled');
            }
        });
    }

    // --- Q8 æ‹–æ‹½æ’åºåˆå§‹åŒ– ---
    new Sortable(document.getElementById('sortList'), {
        animation: 150,
        handle: '.sort-handle', // åªèƒ½æ‹–åŠ¨æŠŠæ‰‹
        ghostClass: 'sort-ghost',
        onEnd: function (evt) {
            // æ‹–åŠ¨ç»“æŸåï¼Œé‡æ–°ç¼–æ’åºå· 1,2,3...
            const items = document.querySelectorAll('.sort-rank-num');
            items.forEach((item, index) => {
                item.innerText = index + 1;
            });
        }
    });

    // --- è·å–å¤šé€‰å€¼çš„è¾…åŠ©å‡½æ•° ---
    function getMultiValues(containerSelector) {
        const btns = document.querySelectorAll(containerSelector + ' .btn-option.selected');
        let values = [];
        btns.forEach(btn => {
            // æ£€æŸ¥æ˜¯å¦æœ‰è¾“å…¥æ¡†
            const input = btn.querySelector('input');
            if (input) {
                values.push(btn.innerText.split(' ')[0] + ': ' + input.value);
            } else {
                values.push(btn.innerText.substring(2).trim()); // å»æ‰emoji
            }
        });
        return values;
    }

    // --- æäº¤é€»è¾‘ ---
    function submitSurvey() {
        const btn = document.getElementById('submitBtn');

        // 1. æ”¶é›†æ•°æ®
        const q1 = document.getElementById('q1').value;
        const q2 = document.getElementById('q2').value;
        const q3 = getMultiValues('#q3_group_is_manual_handled_above'); // ç‰¹æ®Šå¤„ç†
        // Q3 æ‰‹åŠ¨æ”¶é›†
        let q3_vals = [];
        document.querySelectorAll('.card:nth-of-type(3) .selected').forEach(el => q3_vals.push(el.innerText));
        
        const q4 = document.getElementById('q4').value;
        const q4_2 = getMultiValues('#card_q4_2');
        
        // Q5 å“ç‰Œ
        let q5_res = selectedBrands.filter(b => b).join(', ');
        if (selectedBrands.includes('å…¶ä»–')) {
            q5_res += " (" + document.getElementById('q5_manual').value + ")";
        }

        const q6 = document.getElementById('q6').value;
        // Q6å…¶ä»–
        if(q6 === 'å…¶ä»–') { /* é€»è¾‘å·²åœ¨getRadioValueå¤„ç†ï¼Œè¿™é‡Œç®€åŒ– */ }
        const q6_full = document.querySelector('#q6_other').value ? ("å…¶ä»–:" + document.querySelector('#q6_other').value) : q6;

        const q7 = getMultiValues('#q7_group');
        
        // Q8 æ’åº
        let q8_vals = [];
        document.querySelectorAll('#sortList .sort-item').forEach(el => {
            q8_vals.push(el.getAttribute('data-id'));
        });

        const q9 = document.getElementById('q9').value;
        const q10 = document.getElementById('q10').value;
        const q11 = getMultiValues('#card_q11');
        const q12 = document.getElementById('q12').value;
        const q13 = getMultiValues('#q13_group');
        const q14 = getMultiValues('#q14_group');

        // 2. æ ¡éªŒ
        if (!q1 || !q2 || q3_vals.length === 0 || !q4) { alert("ç¬¬ä¸€éƒ¨åˆ†åŸºç¡€ä¿¡æ¯æ²¡å¡«å®Œå“¦~"); return; }
        if (selectedBrands[0] === null) { alert("è¯·è‡³å°‘ç‚¹å‡»é€‰æ‹©ç¬¬ä¸€å°è±¡æœ€æ·±çš„å“ç‰Œ(Q5)"); return; }
        if (!q6_full) { alert("è¯·é€‰æ‹©æœ€è¿‘è´­ä¹°å“ç‰Œ(Q6)"); return; }
        if (q10 && q10.includes("è´­ä¹°è¿‡") && q11.length === 0) { alert("è¯·å‘Šè¯‰æˆ‘ä»¬è¦ä¸è¦ä¸ºé«˜å“è´¨ä»˜è´¹(Q11)"); return; }

        // 3. å‘é€
        btn.innerText = "æäº¤ä¸­...";
        btn.disabled = true;

        const query = Bmob.Query('OysterJuiceSurvey');
        query.set("q1_age", q1);
        query.set("q2_role", q2);
        query.set("q3_coastal", q3_vals);
        query.set("q4_freq", q4);
        query.set("q4_reason", q4_2);
        query.set("q5_recall", q5_res);
        query.set("q6_recent", q6_full);
        query.set("q7_why", q7);
        query.set("q8_rank", q8_vals.join(' > ')); // å­˜ä¸º "å£å‘³ > ä»·æ ¼ > ..."
        query.set("q9_pref", q9);
        query.set("q10_aware", q10);
        query.set("q11_opinion", q11);
        query.set("q12_price", q12);
        query.set("q13_trend", q13);
        query.set("q14_channel", q14);

        query.save().then(res => {
            alert("æäº¤æˆåŠŸï¼æ„Ÿè°¢æ‚¨çš„é…åˆã€‚");
            btn.innerText = "å·²å®Œæˆ";
            // åˆ·æ–°é¡µé¢
            setTimeout(() => location.reload(), 1000);
        }).catch(err => {
            alert("æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•");
            btn.disabled = false;
            btn.innerText = "æäº¤é—®å· ğŸ‰";
            console.log(err);
        });
    }
</script>

</body>
</html>
