<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>èšæ±æ¶ˆè´¹åå¥½è°ƒç ”</title>
    <style>
        /* CSS æ ·å¼åŒº - ä¿æŒç¾è§‚ */
        :root {
            --primary: #D94436;
            --primary-light: #FFECEB;
            --bg: #F5F6FA;
            --card: #FFFFFF;
            --text: #333;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", sans-serif;
            background-color: var(--bg);
            margin: 0; padding: 0;
            color: var(--text);
            padding-bottom: 100px;
            -webkit-tap-highlight-color: transparent; /* å»é™¤ç‚¹å‡»é«˜äº® */
        }
        /* å¤´éƒ¨ */
        .header {
            background: linear-gradient(135deg, #D94436 0%, #FF6B6B 100%);
            padding: 25px 20px 35px;
            color: white;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
            box-shadow: 0 4px 10px rgba(217, 68, 54, 0.2);
        }
        .header h1 { margin: 0; font-size: 20px; font-weight: 800; }
        .header p { margin: 5px 0 0; font-size: 12px; opacity: 0.9; }

        .container { max-width: 600px; margin: -25px auto 0; padding: 0 15px; position: relative; z-index: 2; }

        /* å¡ç‰‡ */
        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.03);
        }
        .q-title {
            font-weight: 700; font-size: 16px; margin-bottom: 12px;
            line-height: 1.4; color: #000;
        }
        .q-tag {
            background: var(--primary-light); color: var(--primary);
            font-size: 12px; padding: 2px 6px; border-radius: 4px;
            margin-right: 6px; font-weight: bold;
        }

        /* æŒ‰é’®ç»„ */
        .btn-group { display: flex; flex-direction: column; gap: 8px; }
        .btn-option {
            padding: 12px 15px;
            background: #F8F9FA;
            border: 1px solid #EEE;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.1s;
            position: relative;
        }
        .btn-option:active { background: #EFEFEF; }
        .btn-option.selected {
            background: var(--primary-light);
            border-color: var(--primary);
            color: var(--primary);
            font-weight: bold;
        }
        .btn-option.selected::after {
            content: 'âœ”'; position: absolute; right: 15px; top: 12px;
        }

        /* å“ç‰Œæ¸¸æˆåŒº */
        .brand-slots { display: flex; gap: 8px; margin-bottom: 12px; }
        .brand-slot {
            flex: 1; height: 36px; border: 2px dashed #CCC;
            border-radius: 6px; display: flex; align-items: center; justify-content: center;
            font-size: 12px; color: #999; background: #FAFAFA;
            position: relative;
        }
        .brand-slot.filled {
            background: #FFF0F0; border-color: #D94436; border-style: solid;
            color: #D94436; font-weight: bold;
        }
        .brand-pool { display: flex; flex-wrap: wrap; gap: 8px; }
        .brand-chip {
            padding: 5px 10px; background: white; border: 1px solid #DDD;
            border-radius: 15px; font-size: 13px; cursor: pointer;
        }
        .brand-chip.disabled { background: #EEE; color: #BBB; pointer-events: none; }

        /* æ‹–æ‹½æ’åº */
        .sort-list { list-style: none; padding: 0; margin: 0; }
        .sort-item {
            background: white; border: 1px solid #EEE;
            padding: 12px; margin-bottom: 8px;
            border-radius: 8px; display: flex; align-items: center;
            justify-content: space-between;
        }
        .sort-handle { font-size: 20px; color: #CCC; padding: 0 10px; }
        .sort-num {
            background: #EEE; width: 20px; height: 20px; border-radius: 50%;
            text-align: center; line-height: 20px; font-size: 12px; margin-right: 10px; color: #666;
        }

        .submit-btn {
            background: var(--primary); color: white; width: 100%;
            padding: 15px; border: none; border-radius: 30px;
            font-size: 16px; font-weight: bold; margin-top: 20px;
            box-shadow: 0 5px 15px rgba(217, 68, 54, 0.3);
        }
        .submit-btn:disabled { background: #CCC; box-shadow: none; }
        
        .hidden { display: none !important; }
        .section-title { font-size: 13px; color: #999; text-align: center; margin: 20px 0 10px; font-weight: bold; }
        input[type="text"] { border: none; border-bottom: 1px solid #ccc; background: transparent; outline: none; width: 100px; margin-left: 5px;}
    </style>
</head>
<body>

<div class="header">
    <h1>ğŸ¥˜ èšæ±/èšæ²¹è°ƒç ”</h1>
    <p>ä»…éœ€2åˆ†é’Ÿï¼Œæ„Ÿè°¢æ‚¨çš„æ”¯æŒ</p>
</div>

<div class="container">
    <form id="surveyForm">

        <!-- åŸºç¡€ä¿¡æ¯ -->
        <div class="section-title">01 / åŸºç¡€ä¿¡æ¯</div>

        <!-- Q1 -->
        <div class="card">
            <div class="q-title"><span class="q-tag">Q1</span>æ‚¨çš„å¹´é¾„æ®µï¼Ÿ</div>
            <div class="btn-group" id="group_q1">
                <div class="btn-option" onclick="selectSingle('q1', this)" data-val="18-25å²">ğŸŒ± 18-25å²</div>
                <div class="btn-option" onclick="selectSingle('q1', this)" data-val="26-35å²">ğŸ’¼ 26-35å²</div>
                <div class="btn-option" onclick="selectSingle('q1', this)" data-val="36-45å²">ğŸ  36-45å²</div>
                <div class="btn-option" onclick="selectSingle('q1', this)" data-val="46-55å²">â˜• 46-55å²</div>
                <div class="btn-option" onclick="selectSingle('q1', this)" data-val="56å²åŠä»¥ä¸Š">ğŸ‘´ 56å²åŠä»¥ä¸Š</div>
            </div>
            <input type="hidden" id="input_q1">
        </div>

        <!-- Q2 -->
        <div class="card">
            <div class="q-title"><span class="q-tag">Q2</span>å®¶ä¸­è°ä¹°è°ƒå‘³å“ï¼Ÿ</div>
            <div class="btn-group" id="group_q2">
                <div class="btn-option" onclick="selectSingle('q2', this)" data-val="è‡ªå·±">ğŸ™‹ è‡ªå·±</div>
                <div class="btn-option" onclick="selectSingle('q2', this)" data-val="é…å¶/ä¼´ä¾£">ğŸ’‘ é…å¶/ä¼´ä¾£</div>
                <div class="btn-option" onclick="selectSingle('q2', this)" data-val="çˆ¶æ¯">ğŸ‘ª çˆ¶æ¯</div>
                <div class="btn-option" onclick="selectSingle('q2', this)" data-val="å…¶ä»–">ğŸ”˜ å…¶ä»–</div>
            </div>
            <input type="hidden" id="input_q2">
        </div>

        <!-- Q3 æ²¿æµ· -->
        <div class="card">
            <div class="q-title"><span class="q-tag">Q3</span>æ˜¯å¦ä¸ºæ²¿æµ·åœ°åŒºï¼Ÿ(å¤šé€‰)</div>
            <div class="btn-group" id="group_q3">
                <div class="btn-option" onclick="selectCoastal(this)" data-val="å¸¸ä½åœ°æ˜¯">ğŸŒŠ å¸¸ä½åœ°æ˜¯æ²¿æµ·åœ°åŒº</div>
                <div class="btn-option" onclick="selectCoastal(this)" data-val="ç¥–ç±æ˜¯">ğŸ® ç¥–ç±æ˜¯æ²¿æµ·åœ°åŒº</div>
                <div class="btn-option" onclick="selectCoastal(this)" data-val="éƒ½ä¸æ˜¯">ğŸ”ï¸ éƒ½ä¸æ˜¯</div>
            </div>
        </div>

        <!-- Q4 é¢‘ç‡ -->
        <div class="card">
            <div class="q-title"><span class="q-tag">Q4</span>ä½¿ç”¨é¢‘ç‡ï¼Ÿ</div>
            <div class="btn-group" id="group_q4">
                <div class="btn-option" onclick="selectFreq(this)" data-val="å‡ ä¹æ¯å¤©">ğŸ”¥ å‡ ä¹æ¯å¤©ä½¿ç”¨</div>
                <div class="btn-option" onclick="selectFreq(this)" data-val="æ¯å‘¨å‡ æ¬¡">ğŸ—“ï¸ æ¯å‘¨å‡ æ¬¡</div>
                <div class="btn-option" onclick="selectFreq(this)" data-val="æ¯æœˆå‡ æ¬¡">ğŸŒ™ æ¯æœˆå‡ æ¬¡</div>
                <div class="btn-option" onclick="selectFreq(this)" data-val="å¾ˆå°‘ä½¿ç”¨">â„ï¸ å¾ˆå°‘ä½¿ç”¨</div>
                <div class="btn-option" onclick="selectFreq(this)" data-val="ä»ä¸ä½¿ç”¨">âŒ ä»ä¸ä½¿ç”¨</div>
            </div>
            <input type="hidden" id="input_q4">
        </div>

        <!-- Q4.2 ä¸ç”¨åŸå›  -->
        <div class="card hidden" id="card_q4_2">
            <div class="q-title"><span class="q-tag">Q4.2</span>ä¸ç”¨çš„åŸå› æ˜¯ï¼Ÿ(å¤šé€‰)</div>
            <div class="btn-group" id="group_q4_2">
                <div class="btn-option" onclick="selectMulti(this)" data-val="æ§ç›">ğŸ§‚ éœ€è¦æ§é’ /ä½ç›é¥®é£Ÿ</div>
                <div class="btn-option" onclick="selectMulti(this)" data-val="æµ·é²œè¿‡æ•">ğŸš‘ æµ·é²œè¿‡æ•/å¿Œå£</div>
                <div class="btn-option" onclick="selectMulti(this)" data-val="æ·»åŠ å‰‚">ğŸ§ª ä¸å–œæ¬¢æ·»åŠ å‰‚</div>
                <div class="btn-option" onclick="selectMulti(this)" data-val="å…¶ä»–æ›¿ä»£">ğŸ² æœ‰å…¶ä»–æ›¿ä»£å“</div>
                <div class="btn-option" onclick="selectMulti(this)" data-val="å…¶ä»–">âšª å…¶ä»–</div>
            </div>
        </div>

        <!-- å“ç‰Œéƒ¨åˆ† -->
        <div class="section-title">02 / å“ç‰Œä¸åå¥½</div>

        <!-- Q5 å“ç‰Œå°è±¡ -->
        <div class="card">
            <div class="q-title"><span class="q-tag">Q5</span>å°è±¡æœ€æ·±çš„ä¸‰ä¸ªå“ç‰Œï¼Ÿ</div>
            <div class="brand-slots">
                <div class="brand-slot" id="slot_0" onclick="removeBrand(0)">1</div>
                <div class="brand-slot" id="slot_1" onclick="removeBrand(1)">2</div>
                <div class="brand-slot" id="slot_2" onclick="removeBrand(2)">3</div>
            </div>
            <div class="brand-pool">
                <div class="brand-chip" onclick="addBrand(this, 'æµ·å¤©')">æµ·å¤©</div>
                <div class="brand-chip" onclick="addBrand(this, 'æé”¦è®°')">æé”¦è®°</div>
                <div class="brand-chip" onclick="addBrand(this, 'å¨é‚¦')">å¨é‚¦</div>
                <div class="brand-chip" onclick="addBrand(this, 'åƒç¦¾')">åƒç¦¾</div>
                <div class="brand-chip" onclick="addBrand(this, 'æ—å°ç”Ÿ')">æ—å°ç”Ÿ</div>
                <div class="brand-chip" onclick="addBrand(this, 'æ²™äº•')">æ²™äº•</div>
                <div class="brand-chip" onclick="addBrand(this, 'å…¶ä»–')">å…¶ä»–</div>
            </div>
            <input type="text" id="q5_manual" class="hidden" placeholder="è¯·è¾“å…¥å“ç‰Œ" style="width:100%; margin-top:10px; border:1px solid #eee; padding:5px;">
        </div>

        <!-- Q6 æœ€è¿‘è´­ä¹° -->
        <div class="card">
            <div class="q-title"><span class="q-tag">Q6</span>æœ€è¿‘ä¹°çš„æ˜¯ï¼Ÿ</div>
            <div class="btn-group" id="group_q6">
                <div class="btn-option" onclick="selectSingle('q6', this)" data-val="æµ·å¤©">æµ·å¤©</div>
                <div class="btn-option" onclick="selectSingle('q6', this)" data-val="æé”¦è®°">æé”¦è®°</div>
                <div class="btn-option" onclick="selectSingle('q6', this)" data-val="å¨é‚¦">å¨é‚¦</div>
                <div class="btn-option" onclick="selectSingle('q6', this)" data-val="åƒç¦¾">åƒç¦¾</div>
                <div class="btn-option" onclick="selectSingle('q6', this)" data-val="æ—å°ç”Ÿ">æ—å°ç”Ÿ</div>
                <div class="btn-option" onclick="selectSingle('q6', this)" data-val="å…¶ä»–">å…¶ä»– <input type="text" id="q6_other" onclick="event.stopPropagation()"></div>
            </div>
            <input type="hidden" id="input_q6">
        </div>

        <!-- Q7 åŸå›  -->
        <div class="card">
            <div class="q-title"><span class="q-tag">Q7</span>è´­ä¹°åŸå› ï¼Ÿ(æœ€å¤šé€‰3é¡¹)</div>
            <div class="btn-group" id="group_q7">
                <div class="btn-option" onclick="selectMultiLimit(this, 3)" data-val="å“ç‰Œ">ğŸ† å“ç‰Œä¿¡èª‰å¥½</div>
                <div class="btn-option" onclick="selectMultiLimit(this, 3)" data-val="å£å‘³">ğŸ˜‹ å£å‘³/é²œå‘³å¥½</div>
                <div class="btn-option" onclick="selectMultiLimit(this, 3)" data-val="é…æ–¹">ğŸƒ é…æ–¹çº¯å‡€/é›¶æ·»åŠ </div>
                <div class="btn-option" onclick="selectMultiLimit(this, 3)" data-val="ä»·æ ¼">ğŸ’° ä»·æ ¼å®æƒ </div>
                <div class="btn-option" onclick="selectMultiLimit(this, 3)" data-val="ä¿ƒé”€">ğŸ ä¿ƒé”€æ´»åŠ¨</div>
                <div class="btn-option" onclick="selectMultiLimit(this, 3)" data-val="åŒ…è£…">ğŸ“¦ åŒ…è£…è®¾è®¡å¥½</div>
                <div class="btn-option" onclick="selectMultiLimit(this, 3)" data-val="å…¶ä»–">âšª å…¶ä»–</div>
            </div>
        </div>

        <!-- Q8 æ’åº -->
        <div class="card">
            <div class="q-title"><span class="q-tag">Q8</span>æœ€å…³æ³¨å› ç´ æ’åº (é•¿æŒ‰æ‹–æ‹½ â†•ï¸)</div>
            <ul class="sort-list" id="sortList">
                <li class="sort-item" data-id="å£å‘³"><div style="display:flex;align-items:center"><div class="sort-num">1</div>å£å‘³ä¸é²œåº¦</div><div class="sort-handle">â˜°</div></li>
                <li class="sort-item" data-id="èšæ±å«é‡"><div style="display:flex;align-items:center"><div class="sort-num">2</div>èšæ±å«é‡</div><div class="sort-handle">â˜°</div></li>
                <li class="sort-item" data-id="é›¶æ·»åŠ "><div style="display:flex;align-items:center"><div class="sort-num">3</div>é…æ–™è¡¨æ¸…æ´</div><div class="sort-handle">â˜°</div></li>
                <li class="sort-item" data-id="ä»·æ ¼"><div style="display:flex;align-items:center"><div class="sort-num">4</div>ä»·æ ¼</div><div class="sort-handle">â˜°</div></li>
                <li class="sort-item" data-id="å“ç‰Œ"><div style="display:flex;align-items:center"><div class="sort-num">5</div>å“ç‰Œ</div><div class="sort-handle">â˜°</div></li>
                <li class="sort-item" data-id="åŒ…è£…"><div style="display:flex;align-items:center"><div class="sort-num">6</div>åŒ…è£…ä¾¿åˆ©æ€§</div><div class="sort-handle">â˜°</div></li>
            </ul>
        </div>

        <!-- Q9 æ–°å‹ -->
        <div class="card">
            <div class="q-title"><span class="q-tag">Q9</span>æœ€èƒ½æ¥å—çš„æ–°å‹èšæ²¹ï¼Ÿ</div>
            <div class="btn-group" id="group_q9">
                <div class="btn-option" onclick="selectSingle('q9', this)" data-val="100%èšæ±">ğŸ’§ 100%èšæ±(ç¨€ä½†é²œ)</div>
                <div class="btn-option" onclick="selectSingle('q9', this)" data-val="ä¼´é¦…èšæ²¹">ğŸ¯ ä¼´é¦…èšæ²¹(ç¨ )</div>
                <div class="btn-option" onclick="selectSingle('q9', this)" data-val="ç´ èšæ²¹">ğŸ„ ç´ èšæ²¹</div>
                <div class="btn-option" onclick="selectSingle('q9', this)" data-val="éƒ½ä¸å–œæ¬¢">ğŸ™… éƒ½ä¸å–œæ¬¢</div>
            </div>
            <input type="hidden" id="input_q9">
        </div>

        <!-- Q10 è®¤çŸ¥ -->
        <div class="card">
            <div class="q-title"><span class="q-tag">Q10</span>æ˜¯å¦å¬è¯´â€œé«˜èšæ±â€å“ç‰Œï¼Ÿ</div>
            <div class="btn-group" id="group_q10">
                <div class="btn-option" onclick="selectQ10(this)" data-val="æ˜¯ï¼Œè´­ä¹°è¿‡">ğŸ›’ æ˜¯ï¼Œè´­ä¹°è¿‡</div>
                <div class="btn-option" onclick="selectQ10(this)" data-val="æ˜¯ï¼Œå¬è¯´è¿‡">ğŸ‘‚ æ˜¯ï¼Œå¬è¯´è¿‡ä½†æœªä¹°</div>
                <div class="btn-option" onclick="selectQ10(this)" data-val="æ²¡å¬è¯´è¿‡">âŒ æ²¡å¬è¯´è¿‡</div>
            </div>
            <input type="hidden" id="input_q10">
        </div>

        <!-- Q11 çœ‹æ³• -->
        <div class="card hidden" id="card_q11">
            <div class="q-title"><span class="q-tag">Q11</span>æ‚¨çš„çœ‹æ³•ï¼Ÿ(å¤šé€‰)</div>
            <div class="btn-group" id="group_q11">
                <div class="btn-option" onclick="selectMulti(this)" data-val="æ„¿æ„ä»˜è´¹">ğŸ’ æ„¿æ„ä¸ºå“è´¨ä»˜è´¹</div>
                <div class="btn-option" onclick="selectMulti(this)" data-val="å¤ªè´µ">ğŸ’¸ æ„Ÿå…´è¶£ä½†å«Œè´µ</div>
                <div class="btn-option" onclick="selectMulti(this)" data-val="æ™ºå•†ç¨">ğŸ§  æ€€ç–‘æ˜¯è¥é”€æ¦‚å¿µ</div>
            </div>
        </div>

        <!-- Q12 ä»·æ ¼ -->
        <div class="card">
            <div class="q-title"><span class="q-tag">Q12</span>èƒ½æ¥å—çš„ä»·æ ¼(500g)ï¼Ÿ</div>
            <div class="btn-group" id="group_q12">
                <div class="btn-option" onclick="selectSingle('q12', this)" data-val="15å…ƒä»¥ä¸‹">15å…ƒä»¥ä¸‹</div>
                <div class="btn-option" onclick="selectSingle('q12', this)" data-val="16-25å…ƒ">16-25å…ƒ</div>
                <div class="btn-option" onclick="selectSingle('q12', this)" data-val="26-35å…ƒ">26-35å…ƒ</div>
                <div class="btn-option" onclick="selectSingle('q12', this)" data-val="36å…ƒä»¥ä¸Š">36å…ƒä»¥ä¸Š</div>
            </div>
            <input type="hidden" id="input_q12">
        </div>

        <!-- Q13 è¶‹åŠ¿ -->
        <div class="card">
            <div class="q-title"><span class="q-tag">Q13</span>æœªæ¥å…³æ³¨ï¼Ÿ(æœ€å¤š3é¡¹)</div>
            <div class="btn-group" id="group_q13">
                <div class="btn-option" onclick="selectMultiLimit(this, 3)" data-val="åŠŸèƒ½æ€§">ğŸ¥— åŠŸèƒ½æ€§(å‡ç›/å¥åº·)</div>
                <div class="btn-option" onclick="selectMultiLimit(this, 3)" data-val="é«˜ç«¯åŒ–">ğŸ¦ª é«˜ç«¯åŒ–(åŸäº§åœ°)</div>
                <div class="btn-option" onclick="selectMultiLimit(this, 3)" data-val="ä¾¿æ·æ€§">ğŸ–ï¸ ä¾¿æ·æ€§(æŒ¤æŒ¤è£…)</div>
                <div class="btn-option" onclick="selectMultiLimit(this, 3)" data-val="å£å‘³">ğŸŒ¶ï¸ å£å‘³åˆ›æ–°</div>
            </div>
        </div>

        <!-- Q14 æ¸ é“ -->
        <div class="card">
            <div class="q-title"><span class="q-tag">Q14</span>äº†è§£æ¸ é“ï¼Ÿ(å¤šé€‰)</div>
            <div class="btn-group" id="group_q14">
                <div class="btn-option" onclick="selectMulti(this)" data-val="ç”µå•†">ğŸ“± ç”µå•†å¹³å°</div>
                <div class="btn-option" onclick="selectMulti(this)" data-val="çŸ­è§†é¢‘">ğŸ¬ çŸ­è§†é¢‘/ç›´æ’­</div>
                <div class="btn-option" onclick="selectMulti(this)" data-val="å•†è¶…">ğŸª çº¿ä¸‹å•†è¶…</div>
                <div class="btn-option" onclick="selectMulti(this)" data-val="äº²å‹">ğŸ—£ï¸ äº²å‹æ¨è</div>
                <div class="btn-option" onclick="selectMulti(this)" data-val="å…¶ä»–">âšª å…¶ä»–</div>
            </div>
        </div>

        <button type="button" class="submit-btn" onclick="submitData()" id="btnSubmit">æäº¤é—®å·</button>
        <div style="height: 50px;"></div>

    </form>
</div>

<!-- ================= è„šæœ¬åŒº (æ”¾åœ¨åº•éƒ¨é˜²æ­¢ç™½å±) ================= -->
<!-- 1. å¼•å…¥æ›´å¿«çš„ CDN -->
<script src="https://cdn.bootcdn.net/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
<script src="https://unpkg.com/bmob-js-sdk-v4/dist/Bmob-4.0.0.min.js"></script>

<script>
    // 2. åˆå§‹åŒ– Bmob (è¯·ç¡®è®¤å¯†é’¥æ— è¯¯)
    try {
        Bmob.initialize("70f9577e95b2858b", "1234567890123456"); 
        console.log("Bmob init success");
    } catch(e) {
        console.error("Bmob init failed", e);
    }

    // 3. é€šç”¨é€»è¾‘å‡½æ•°
    function selectSingle(qId, btn) {
        // æ¸…é™¤åŒç»„æ ·å¼
        var parent = btn.parentNode;
        var siblings = parent.getElementsByClassName('btn-option');
        for (var i = 0; i < siblings.length; i++) {
            siblings[i].classList.remove('selected');
        }
        // é€‰ä¸­è‡ªå·±
        btn.classList.add('selected');
        // èµ‹å€¼
        document.getElementById('input_' + qId).value = btn.getAttribute('data-val');
    }

    function selectMulti(btn) {
        btn.classList.toggle('selected');
    }

    function selectMultiLimit(btn, limit) {
        var parent = btn.parentNode;
        var selectedCount = parent.querySelectorAll('.selected').length;
        if (!btn.classList.contains('selected') && selectedCount >= limit) {
            alert('æœ€å¤šé€‰æ‹© ' + limit + ' é¡¹');
            return;
        }
        btn.classList.toggle('selected');
    }

    // Q3 ç‰¹æ®Šé€»è¾‘
    function selectCoastal(btn) {
        var val = btn.getAttribute('data-val');
        var parent = btn.parentNode;
        var btns = parent.getElementsByClassName('btn-option');
        
        if (val === 'éƒ½ä¸æ˜¯') {
            // å–æ¶ˆå…¶ä»–
            for(var i=0; i<btns.length; i++) btns[i].classList.remove('selected');
            btn.classList.add('selected');
        } else {
            // å–æ¶ˆâ€œéƒ½ä¸æ˜¯â€
            for(var i=0; i<btns.length; i++) {
                if(btns[i].getAttribute('data-val') === 'éƒ½ä¸æ˜¯') btns[i].classList.remove('selected');
            }
            btn.classList.toggle('selected');
        }
    }

    // Q4 é¢‘ç‡ -> æ˜¾ç¤º Q4.2
    function selectFreq(btn) {
        selectSingle('q4', btn);
        var val = btn.getAttribute('data-val');
        var card = document.getElementById('card_q4_2');
        if (val === 'å¾ˆå°‘ä½¿ç”¨' || val === 'ä»ä¸ä½¿ç”¨') {
            card.classList.remove('hidden');
        } else {
            card.classList.add('hidden');
        }
    }

    // Q10 -> æ˜¾ç¤º Q11
    function selectQ10(btn) {
        selectSingle('q10', btn);
        var val = btn.getAttribute('data-val');
        var card = document.getElementById('card_q11');
        if (val === 'æ˜¯ï¼Œè´­ä¹°è¿‡') {
            card.classList.remove('hidden');
        } else {
            card.classList.add('hidden');
        }
    }

    // --- å“ç‰Œæ¸¸æˆé€»è¾‘ ---
    var pickedBrands = [null, null, null];
    function addBrand(btn, name) {
        if(btn.classList.contains('disabled')) return;
        
        // æ‰¾ç©ºä½
        var idx = pickedBrands.indexOf(null);
        if(idx === -1) {
            alert("åªèƒ½é€‰3ä¸ªï¼Œç‚¹å‡»ä¸Šé¢æ ¼å­å¯åˆ é™¤");
            return;
        }
        pickedBrands[idx] = name;
        renderBrands();

        if(name === 'å…¶ä»–') {
            document.getElementById('q5_manual').classList.remove('hidden');
        }
    }

    function removeBrand(idx) {
        if(pickedBrands[idx] === 'å…¶ä»–') {
            document.getElementById('q5_manual').classList.add('hidden');
        }
        pickedBrands[idx] = null;
        renderBrands();
    }

    function renderBrands() {
        for(var i=0; i<3; i++) {
            var el = document.getElementById('slot_'+i);
            if(pickedBrands[i]) {
                el.innerText = pickedBrands[i];
                el.classList.add('filled');
                el.innerHTML = pickedBrands[i] + ' <span style="font-size:10px">Ã—</span>';
            } else {
                el.innerText = (i+1);
                el.classList.remove('filled');
            }
        }
    }

    // --- æ’åºé€»è¾‘ ---
    var sortList = document.getElementById('sortList');
    if(typeof Sortable !== 'undefined') {
        new Sortable(sortList, {
            animation: 150,
            handle: '.sort-handle',
            onEnd: function() {
                // æ›´æ–°åºå·
                var items = sortList.getElementsByClassName('sort-num');
                for(var i=0; i<items.length; i++) {
                    items[i].innerText = (i+1);
                }
            }
        });
    } else {
        console.log("Sortable loaded failed/slow");
    }

    // --- è¾…åŠ©è·å–å¤šé€‰å€¼ ---
    function getMultiVals(groupId) {
        var btns = document.querySelectorAll('#' + groupId + ' .selected');
        var vals = [];
        for(var i=0; i<btns.length; i++) {
            vals.push(btns[i].getAttribute('data-val'));
        }
        return vals;
    }

    // --- æäº¤ ---
    function submitData() {
        var btn = document.getElementById('btnSubmit');

        // æ”¶é›†æ•°æ®
        var q1 = document.getElementById('input_q1').value;
        var q2 = document.getElementById('input_q2').value;
        var q3 = getMultiVals('group_q3');
        var q4 = document.getElementById('input_q4').value;
        var q4_2 = getMultiVals('group_q4_2');
        
        // å“ç‰Œå¤„ç†
        var q5_arr = pickedBrands.filter(function(v){ return v!=null; });
        var q5 = q5_arr.join(',');
        if(pickedBrands.includes('å…¶ä»–')) q5 += "("+document.getElementById('q5_manual').value+")";

        var q6 = document.getElementById('input_q6').value;
        if(q6 === 'å…¶ä»–') q6 += " " + document.getElementById('q6_other').value;

        var q7 = getMultiVals('group_q7');
        
        // æ’åº
        var q8 = [];
        var sortItems = document.querySelectorAll('.sort-item');
        for(var i=0; i<sortItems.length; i++) q8.push(sortItems[i].getAttribute('data-id'));
        
        var q9 = document.getElementById('input_q9').value;
        var q10 = document.getElementById('input_q10').value;
        var q11 = getMultiVals('group_q11');
        var q12 = document.getElementById('input_q12').value;
        var q13 = getMultiVals('group_q13');
        var q14 = getMultiVals('group_q14');

        // ç®€å•æ ¡éªŒ
        if(!q1 || !q2 || q3.length===0 || !q4) {
            alert("åŸºç¡€ä¿¡æ¯æœªå¡«å®Œ"); return;
        }
        if(q5_arr.length === 0) {
            alert("è¯·é€‰æ‹©å°è±¡æ·±çš„å“ç‰Œ(Q5)"); return;
        }

        btn.innerText = "æäº¤ä¸­...";
        btn.disabled = true;

        var query = Bmob.Query('OysterJuiceSurvey');
        query.set("q1_age", q1);
        query.set("q2_role", q2);
        query.set("q3_coastal", q3);
        query.set("q4_freq", q4);
        query.set("q4_reason", q4_2);
        query.set("q5_recall", q5);
        query.set("q6_recent", q6);
        query.set("q7_why", q7);
        query.set("q8_rank", q8.join('>'));
        query.set("q9_pref", q9);
        query.set("q10_aware", q10);
        query.set("q11_opinion", q11);
        query.set("q12_price", q12);
        query.set("q13_trend", q13);
        query.set("q14_channel", q14);

        query.save().then(function(res){
            alert("âœ… æäº¤æˆåŠŸï¼");
            btn.innerText = "å·²å®Œæˆ";
        }).catch(function(err){
            alert("âŒ æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•");
            console.log(err);
            btn.disabled = false;
            btn.innerText = "é‡æ–°æäº¤";
        });
    }
</script>

</body>
</html>
